<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XOR Weight Lab</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --ink: #0b1220;
      --muted: #4b5563;
      --accent: #ff6b3d;
      --accent-2: #ffd166;
      --panel: rgba(255, 255, 255, 0.9);
      --shadow: 0 25px 60px rgba(15, 23, 42, 0.12);
      --border: rgba(15, 23, 42, 0.08);
      --bg-1: #fef3c7;
      --bg-2: #dbeafe;
      --bg-3: #f3e8ff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Space Grotesk", sans-serif;
      color: var(--ink);
      background: radial-gradient(circle at 15% 20%, var(--bg-2), transparent 55%),
        radial-gradient(circle at 85% 10%, var(--bg-3), transparent 50%),
        linear-gradient(135deg, var(--bg-1), #ffffff 70%);
      min-height: 100vh;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 48px 24px 80px;
      position: relative;
    }

    .hero {
      display: grid;
      gap: 18px;
      margin-bottom: 32px;
    }

    .hero h1 {
      font-size: clamp(2.4rem, 4vw, 3.6rem);
      margin: 0;
      letter-spacing: -0.02em;
    }

    .hero p {
      margin: 0;
      max-width: 720px;
      color: var(--muted);
      font-size: 1.05rem;
      line-height: 1.6;
    }

    .hero h2 {
      margin: 12px 0 0;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #111827;
    }

    .hero details {
      max-width: 720px;
    }

    .hero summary {
      cursor: pointer;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #111827;
      list-style: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .hero summary::-webkit-details-marker {
      display: none;
    }

    .hero summary::after {
      content: "▾";
      font-size: 0.85rem;
      transition: transform 0.2s ease;
    }

    .hero details[open] summary::after {
      transform: rotate(180deg);
    }

    .hero details p {
      margin-top: 8px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 6px;
    }

    .pill {
      font-family: "IBM Plex Mono", monospace;
      font-size: 0.85rem;
      padding: 6px 12px;
      border-radius: 999px;
      background: #111827;
      color: #f8fafc;
      letter-spacing: 0.02em;
    }

    .workbench {
      display: grid;
      grid-template-columns: minmax(280px, 1fr) minmax(320px, 1fr);
      gap: 16px;
      align-items: start;
    }

    .stack {
      display: grid;
      gap: 20px;
    }

    .right-column {
      justify-self: stretch;
      width: 100%;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .panel h2 {
      margin: 0 0 16px;
      font-size: 1.2rem;
    }

    .math-block {
      font-family: "IBM Plex Mono", monospace;
      font-size: 0.95rem;
      color: var(--muted);
      background: rgba(15, 23, 42, 0.04);
      border-radius: 14px;
      padding: 12px 16px;
      margin-bottom: 16px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
    }

    .math-block > div {
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .panel h3 {
      margin: 0 0 10px;
      font-size: 1rem;
      color: var(--muted);
    }

    .controls-grid {
      display: grid;
      gap: 14px;
    }

    .control {
      display: grid;
      gap: 8px;
    }

    .control label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.95rem;
    }

    .control label span {
      font-family: "IBM Plex Mono", monospace;
      font-size: 0.85rem;
      color: var(--muted);
    }

    input[type="range"] {
      width: 100%;
      accent-color: var(--accent);
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 16px;
    }

    .toggle-row {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
      color: var(--muted);
      margin-top: 12px;
    }

    .toggle-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--accent);
    }

    .weight-table input:disabled {
      color: #9ca3af;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-weight: 600;
      font-family: "Space Grotesk", sans-serif;
      cursor: pointer;
      background: var(--accent);
      color: #111827;
      box-shadow: 0 12px 25px rgba(255, 107, 61, 0.25);
    }

    button.secondary {
      background: #111827;
      color: #f8fafc;
    }

    button.toggle {
      background: #ffffff;
      color: #111827;
      border: 1px solid rgba(17, 24, 39, 0.15);
      box-shadow: none;
    }

    button.toggle.active {
      background: #111827;
      color: #f8fafc;
    }

    .viz {
      display: grid;
      gap: 16px;
    }

    .network-editor {
      display: grid;
      gap: 18px;
      grid-template-columns: 1fr;
      align-items: start;
    }

    .diagram-wrap {
      background: rgba(15, 23, 42, 0.04);
      border-radius: 16px;
      padding: 16px;
    }

    .diagram-wrap svg {
      width: 100%;
      height: 260px;
      display: block;
    }

    .weight-table {
      width: 100%;
      border-collapse: collapse;
      font-family: "IBM Plex Mono", monospace;
      font-size: 0.9rem;
    }

    .weight-table th,
    .weight-table td {
      border: 1px solid var(--border);
      padding: 6px;
      text-align: center;
    }

    .weight-table th {
      background: rgba(15, 23, 42, 0.04);
      font-weight: 500;
    }

    .weight-table input {
      width: 100%;
      border: none;
      background: transparent;
      font-family: "IBM Plex Mono", monospace;
      text-align: center;
      color: var(--ink);
    }

    .weight-table input:focus {
      outline: 2px solid var(--accent);
      border-radius: 6px;
      background: #fff7ed;
    }

    .matrix-stack {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      align-items: start;
    }

    #chart {
      width: 100%;
      min-height: 360px;
      text-align: center;
    }

    #chart .vega-embed,
    #chart > div {
      display: inline-block;
      margin: 0 auto;
    }

    .legend {
      display: flex;
      flex-direction: column;
      gap: 12px;
      font-size: 0.9rem;
      color: var(--muted);
      list-style: disc;
      padding-left: 18px;
      margin: 0;
    }

    .truth-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    .truth-card {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      display: grid;
      gap: 6px;
      background: rgba(255, 255, 255, 0.8);
    }

    .truth-card strong {
      font-family: "IBM Plex Mono", monospace;
      font-size: 0.95rem;
    }

    .truth-card span {
      font-size: 0.85rem;
      color: var(--muted);
    }

    .footer {
      margin-top: 24px;
      font-size: 0.85rem;
      color: var(--muted);
    }

    @media (max-width: 720px) {
      .page {
        padding: 32px 18px 60px;
      }

      .panel {
        padding: 18px;
      }

      .workbench {
        grid-template-columns: 1fr;
      }

      .right-column {
        justify-self: stretch;
      }

      .matrix-stack {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="hero">
      <h1>XOR Weight Lab</h1>
      <p>
        XOR is a classic demonstration of why neural networks matter: a single linear
        classifier cannot separate the classes, but a tiny network with a hidden layer can
        bend the space into a nonlinear decision boundary.
      </p>
      <details>
        <summary>Try it</summary>
        <p>
          Dial the weights of a tiny 2-2-1 neural network and watch how the decision surface
          warps. Edit the weight matrices and see the network diagram, predictions, and
          decision surface update instantly.
        </p>
      </details>
    </header>

    <section class="workbench">
      <div class="panel">
        <h2>Network editor</h2>
        <div class="math-block">
          <div>
            $$\begin{aligned}
            \mathbf{h} &= \sigma(\mathbf{W}_1 \mathbf{x} + \mathbf{b}_h) \\
            y &= \sigma(\mathbf{W}_2 \mathbf{h} + b_3)
            \end{aligned}$$
          </div>
          <div id="elementwise-math"></div>
        </div>
        <div class="network-editor">
          <div class="diagram-wrap">
            <svg viewBox="0 0 340 220" role="img" aria-label="Neural network diagram">
              <defs>
                <linearGradient id="edgeGradient" x1="0" x2="1">
                  <stop offset="0%" stop-color="#0f172a" />
                  <stop offset="100%" stop-color="#ff6b3d" />
                </linearGradient>
              </defs>
              <line x1="70" y1="60" x2="160" y2="60" stroke="url(#edgeGradient)" stroke-width="2" />
              <line x1="70" y1="60" x2="160" y2="160" stroke="url(#edgeGradient)" stroke-width="2" />
              <line x1="70" y1="160" x2="160" y2="60" stroke="url(#edgeGradient)" stroke-width="2" />
              <line x1="70" y1="160" x2="160" y2="160" stroke="url(#edgeGradient)" stroke-width="2" />
              <line x1="200" y1="60" x2="290" y2="110" stroke="url(#edgeGradient)" stroke-width="2" />
              <line x1="200" y1="160" x2="290" y2="110" stroke="url(#edgeGradient)" stroke-width="2" />

              <text x="50" y="24" font-size="11" text-anchor="middle" fill="#6b7280" letter-spacing="0.08em">INPUT</text>
              <text x="180" y="24" font-size="11" text-anchor="middle" fill="#6b7280" letter-spacing="0.08em">HIDDEN</text>
              <text x="310" y="24" font-size="11" text-anchor="middle" fill="#6b7280" letter-spacing="0.08em">OUTPUT</text>

              <text id="edge-w11" x="110" y="46" font-size="12" text-anchor="middle" fill="#0f172a"></text>
              <text id="edge-w21" x="112" y="130" font-size="12" text-anchor="middle" fill="#0f172a"></text>
              <text id="edge-w12" x="112" y="90" font-size="12" text-anchor="middle" fill="#0f172a"></text>
              <text id="edge-w22" x="110" y="176" font-size="12" text-anchor="middle" fill="#0f172a"></text>
              <text id="edge-v1" x="238" y="68" font-size="12" text-anchor="middle" fill="#0f172a"></text>
              <text id="edge-v2" x="238" y="154" font-size="12" text-anchor="middle" fill="#0f172a"></text>

              <rect x="132" y="42" width="36" height="18" rx="6" fill="#fff7ed" stroke="#f97316" stroke-width="1" />
              <rect x="132" y="142" width="36" height="18" rx="6" fill="#fff7ed" stroke="#f97316" stroke-width="1" />
              <rect x="252" y="101" width="36" height="18" rx="6" fill="#fff7ed" stroke="#f97316" stroke-width="1" />
              <text id="act-h1" x="150" y="55" font-size="11" text-anchor="middle" fill="#9a3412">σ</text>
              <text id="act-h2" x="150" y="155" font-size="11" text-anchor="middle" fill="#9a3412">σ</text>
              <text id="act-y" x="270" y="114" font-size="11" text-anchor="middle" fill="#9a3412">σ</text>

              <circle cx="50" cy="60" r="18" fill="#111827" />
              <circle cx="50" cy="160" r="18" fill="#111827" />
              <circle cx="180" cy="60" r="18" fill="#111827" />
              <circle cx="180" cy="160" r="18" fill="#111827" />
              <circle cx="310" cy="110" r="20" fill="#ff6b3d" />

              <text x="50" y="64" font-size="12" text-anchor="middle" fill="#f8fafc">x1</text>
              <text x="50" y="164" font-size="12" text-anchor="middle" fill="#f8fafc">x2</text>
              <text x="180" y="64" font-size="12" text-anchor="middle" fill="#f8fafc">h1</text>
              <text x="180" y="164" font-size="12" text-anchor="middle" fill="#f8fafc">h2</text>
              <text x="310" y="114" font-size="12" text-anchor="middle" fill="#111827">y</text>
            </svg>
          </div>
          <div class="matrix-stack">
            <div>
              <h3>W1: input → hidden</h3>
              <table class="weight-table">
                <thead>
                  <tr>
                    <th></th>
                    <th>h1</th>
                    <th>h2</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>x1</th>
                    <td><input id="w11" type="number" step="0.5"></td>
                    <td><input id="w21" type="number" step="0.5"></td>
                  </tr>
                  <tr>
                    <th>x2</th>
                    <td><input id="w12" type="number" step="0.5"></td>
                    <td><input id="w22" type="number" step="0.5"></td>
                  </tr>
                  <tr>
                    <th>bias</th>
                    <td><input id="b1" type="number" step="0.5"></td>
                    <td><input id="b2" type="number" step="0.5"></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div>
              <h3>W2: hidden → output</h3>
              <table class="weight-table">
                <thead>
                  <tr>
                    <th></th>
                    <th>y</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th>h1</th>
                    <td><input id="v1" type="number" step="0.5"></td>
                  </tr>
                  <tr>
                    <th>h2</th>
                    <td><input id="v2" type="number" step="0.5"></td>
                  </tr>
                  <tr>
                    <th>bias</th>
                    <td><input id="b3" type="number" step="0.5"></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="actions">
          <button id="reset">Reset to XOR-ish</button>
          <button id="randomize" class="secondary">Randomize</button>
          <button id="toggle-activation" class="toggle active">Nonlinearity on</button>
        </div>
        <label class="toggle-row">
          <input id="toggle-bias" type="checkbox" checked>
          Biases enabled
        </label>
      </div>

      <div class="stack right-column">
        <div class="panel">
          <h2>Truth table</h2>
          <div class="truth-grid" id="truth-grid"></div>
          <div class="footer">Values update live as you edit the tables.</div>
        </div>
        <div class="panel viz">
          <h2>Decision surface</h2>
          <div id="chart"></div>
          <ul class="legend">
            <li>Heatmap shows predicted output (0 to 1).</li>
            <li>Dots mark the XOR truth table targets.</li>
          </ul>
        </div>
      </div>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vega@5.25.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.24.0"></script>
  <script>
    MathJax = {
      tex: { inlineMath: [["$", "$"], ["\\(", "\\)"]] }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
  <script>
    const defaults = {
      w11: 20,
      w12: 20,
      b1: -10,
      w21: -20,
      w22: -20,
      b2: 30,
      v1: 20,
      v2: 20,
      b3: -30
    };

    const truthPoints = [
      { x: 0, y: 0, target: 0, label: "(0,0)" },
      { x: 0, y: 1, target: 1, label: "(0,1)" },
      { x: 1, y: 0, target: 1, label: "(1,0)" },
      { x: 1, y: 1, target: 0, label: "(1,1)" }
    ];

    const state = { ...defaults, biasEnabled: true, activationEnabled: true };
    const truthRoot = document.getElementById("truth-grid");
    const elementwiseRoot = document.getElementById("elementwise-math");

    function sigmoid(x) {
      return 1 / (1 + Math.exp(-x));
    }

    function activation(x) {
      return state.activationEnabled ? sigmoid(x) : x;
    }

    function forward(x1, x2) {
      const bias1 = state.biasEnabled ? state.b1 : 0;
      const bias2 = state.biasEnabled ? state.b2 : 0;
      const bias3 = state.biasEnabled ? state.b3 : 0;
      const h1 = activation(state.w11 * x1 + state.w12 * x2 + bias1);
      const h2 = activation(state.w21 * x1 + state.w22 * x2 + bias2);
      return activation(state.v1 * h1 + state.v2 * h2 + bias3);
    }

    const inputIds = ["w11", "w12", "w21", "w22", "v1", "v2", "b1", "b2", "b3"];

    function syncInputs() {
      inputIds.forEach((id) => {
        const input = document.getElementById(id);
        if (input) {
          input.value = state[id].toFixed(1);
        }
      });
    }

    function syncBiasToggle() {
      const toggle = document.getElementById("toggle-bias");
      if (!toggle) return;
      toggle.checked = state.biasEnabled;
      ["b1", "b2", "b3"].forEach((id) => {
        const input = document.getElementById(id);
        if (input) input.disabled = !state.biasEnabled;
      });
    }

    function bindInputs() {
      inputIds.forEach((id) => {
        const input = document.getElementById(id);
        if (!input) return;
        input.addEventListener("input", () => {
          const next = parseFloat(input.value);
          if (!Number.isNaN(next)) {
            state[id] = next;
            updateAll();
          }
        });
      });
    }

    function renderTruthCards() {
      truthRoot.innerHTML = "";
      truthPoints.forEach((point) => {
        const card = document.createElement("div");
        card.className = "truth-card";
        const title = document.createElement("strong");
        title.textContent = `${point.label} target ${point.target}`;
        const value = document.createElement("span");
        value.id = `truth-${point.label}`;
        value.textContent = "pred: 0.00";
        card.appendChild(title);
        card.appendChild(value);
        truthRoot.appendChild(card);
      });
    }

    renderTruthCards();

    const gridSize = 41;

    function buildGrid() {
      const values = [];
      for (let i = 0; i < gridSize; i += 1) {
        const x = i / (gridSize - 1);
        for (let j = 0; j < gridSize; j += 1) {
          const y = j / (gridSize - 1);
          values.push({ x, y, z: forward(x, y) });
        }
      }
      return values;
    }

    const spec = {
      $schema: "https://vega.github.io/schema/vega/v5.json",
      width: 420,
      height: 420,
      autosize: { type: "fit", contains: "padding" },
      padding: 10,
      data: [
        { name: "grid", values: buildGrid() },
        { name: "truth", values: truthPoints }
      ],
      scales: [
        {
          name: "xscale",
          type: "band",
          domain: { data: "grid", field: "x" },
          range: "width",
          paddingInner: 0,
          paddingOuter: 0
        },
        {
          name: "yscale",
          type: "band",
          domain: { data: "grid", field: "y" },
          range: [{ signal: "height" }, 0],
          paddingInner: 0,
          paddingOuter: 0
        },
        {
          name: "color",
          type: "linear",
          domain: [0, 1],
          range: ["#0f172a", "#ffe066"]
        }
      ],
      axes: [
        { scale: "xscale", orient: "bottom", values: [0, 0.25, 0.5, 0.75, 1], title: "x1" },
        { scale: "yscale", orient: "left", values: [0, 0.25, 0.5, 0.75, 1], title: "x2" }
      ],
      marks: [
        {
          type: "rect",
          from: { data: "grid" },
          encode: {
            enter: {
              x: { scale: "xscale", field: "x" },
              y: { scale: "yscale", field: "y" },
              width: { scale: "xscale", band: 1 },
              height: { scale: "yscale", band: 1 }
            },
            update: {
              fill: { scale: "color", field: "z" },
              opacity: { value: 0.9 }
            }
          }
        },
        {
          type: "symbol",
          from: { data: "truth" },
          encode: {
            enter: {
              x: { scale: "xscale", field: "x", band: 0.5 },
              y: { scale: "yscale", field: "y", band: 0.5 },
              size: { value: 220 },
              stroke: { value: "#111827" },
              strokeWidth: { value: 2 }
            },
            update: {
              fill: { scale: "color", field: "target" }
            }
          }
        }
      ]
    };

    let view;

    vegaEmbed("#chart", spec, { actions: false }).then((result) => {
      view = result.view;
      updateAll();
      window.addEventListener("resize", () => view.resize().run());
    });

    function updateTruthCards() {
      truthPoints.forEach((point) => {
        const value = forward(point.x, point.y);
        const label = document.getElementById(`truth-${point.label}`);
        if (label) {
          label.textContent = `pred: ${value.toFixed(3)}`;
        }
      });
    }

    function updateElementwiseMath() {
      if (!elementwiseRoot) return;
      const bias1 = state.biasEnabled ? state.b1 : 0;
      const bias2 = state.biasEnabled ? state.b2 : 0;
      const bias3 = state.biasEnabled ? state.b3 : 0;
      const sigma = state.activationEnabled ? "\\sigma" : "";
      const prefix = state.activationEnabled ? `${sigma}(` : "";
      const suffix = state.activationEnabled ? ")" : "";
      const tex = `$$\\begin{aligned}
      h_1 &= ${prefix}${state.w11.toFixed(1)}\\, x_1 + ${state.w12.toFixed(1)}\\, x_2 + ${bias1.toFixed(1)}${suffix} \\\\
      h_2 &= ${prefix}${state.w21.toFixed(1)}\\, x_1 + ${state.w22.toFixed(1)}\\, x_2 + ${bias2.toFixed(1)}${suffix} \\\\
      y &= ${prefix}${state.v1.toFixed(1)}\\, h_1 + ${state.v2.toFixed(1)}\\, h_2 + ${bias3.toFixed(1)}${suffix}
      \\end{aligned}$$`;
      elementwiseRoot.textContent = tex;
      if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise([elementwiseRoot]);
      }
    }

    function updateEdgeLabels() {
      const map = {
        w11: "edge-w11",
        w12: "edge-w12",
        w21: "edge-w21",
        w22: "edge-w22",
        v1: "edge-v1",
        v2: "edge-v2"
      };
      Object.keys(map).forEach((key) => {
        const label = document.getElementById(map[key]);
        if (label) {
          label.textContent = state[key].toFixed(2);
        }
      });
    }

    function updateActivationLabels() {
      const labelText = state.activationEnabled ? "σ" : "-";
      ["act-h1", "act-h2", "act-y"].forEach((id) => {
        const label = document.getElementById(id);
        if (label) {
          label.textContent = labelText;
        }
      });
    }

    function updateAll() {
      const grid = buildGrid();
      if (view) {
        const change = vega.changeset().remove(() => true).insert(grid);
        view.change("grid", change).run();
      }
      updateTruthCards();
      updateEdgeLabels();
      updateElementwiseMath();
      updateActivationLabels();
    }

    document.getElementById("reset").addEventListener("click", () => {
      Object.keys(defaults).forEach((key) => {
        state[key] = defaults[key];
      });
      syncInputs();
      updateAll();
    });

    document.getElementById("randomize").addEventListener("click", () => {
      Object.keys(defaults).forEach((key) => {
        const value = (Math.random() * 20 - 10).toFixed(1);
        state[key] = parseFloat(value);
      });
      syncInputs();
      updateAll();
    });

    document.getElementById("toggle-bias").addEventListener("change", (event) => {
      state.biasEnabled = event.target.checked;
      syncBiasToggle();
      updateAll();
    });

    const activationToggle = document.getElementById("toggle-activation");
    activationToggle.addEventListener("click", () => {
      state.activationEnabled = !state.activationEnabled;
      activationToggle.classList.toggle("active", state.activationEnabled);
      activationToggle.textContent = state.activationEnabled ? "Nonlinearity on" : "Linear only";
      updateAll();
    });

    syncInputs();
    syncBiasToggle();
    bindInputs();
    updateElementwiseMath();
    updateActivationLabels();
  </script>
</body>
</html>
